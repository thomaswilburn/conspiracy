<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Conspiracy</title>
</head>
<body>
  <div class="root"></div>

  <template>
    <button
      placeholder="true"
      :on.click="clickedtestbutton"
      :on.click.once="clickedonceonly"
      :attributes="button"
      :styles="buttonStyles"
      :dataset="buttonData"
    >TEST</button>
    <input :assign="inputProps"></input>
    <div :element="hello" :on.mousemove="hellomoved" class="container unwanted" :classes="containerClass">
      Hello <!-- :name --> <!-- :coords -->
      <ul>
        <li>FIRST
        <li :each="item, i of nested.items">
          <!-- :name -->
          <a :attr.href="item.url"><!-- :item.label --></a>
          <!-- :item.data -->
        </li>
        <li>LAST
      </ul>
    </div>
    <h1 :if.not="visible">TOGGLE ME <!-- :nested.counter --></h1>
    <h2 :if="visible">I'm different! <!-- :nested.counter --></h2>
    <ul>
      <li :each="value, key of button">
        <!-- :key -->: <!-- :value -->
    </ul>
    <ul>
      <li :each="key, value of mapTest">
        <!-- :key.text --> -> <!-- :value.text -->
    </ul>
  </template>

  <script type="module">
    import { Conspiracy } from "./src/index.js";

    var root = document.querySelector(".root");
    var template = document.querySelector("template").innerHTML.trim();
    var binding = new Conspiracy(template, { unhosted: 0, stripDirectives: true });
    var data = {
      name: "World",
      containerClass: {
        unwanted: false,
        chonky: true
      },
      button: {
        "aria-toggled": "false",
        test: 123,
        placeholder: undefined,
        controls: true
      },
      buttonStyles: {
        backgroundColor: "salmon",
        border: "1px solid black",
        padding: "20px",
        display: "block",
        margin: "8px 0"
      },
      buttonData: {
        tagged: 123
      },
      inputProps: {
        value: "assigned"
      },
      nested: {
        counter: 0,
        items: []
      },
      mapTest: new Map([[{ text: "alpha"}, { text: "uno"}], [{ text: "beta" }, { text: "dos" }]])
    };

    var urlGetter = {
      get() {
        return "#" + this.data;
      }
    };

    var makeItem = function(label) {
      var id = data.nested.items.length;
      return {
        data: id,
        label,
        get url() { return "#" + this.data }
      };
    };

    data.nested.items.push(makeItem("A"));
    data.nested.items.push(makeItem("B"));

    binding.attach(root, data);
    console.log(binding.elements);

    var visible = false;
    document.body.addEventListener("clickedtestbutton", e => {
      console.log(`Got custom event: ${e.type}`);
      data.visible = !data.visible;
      data.nested.counter++;
      var index = (Math.random() * (data.nested.items.length + 1)) | 0;
      var add = makeItem("ADDED");
      data.nested.items.splice(index, 0, add);
      // data.nested.items.push(add);
      console.log(data.nested.items);
      binding.update(data);
    });

    document.body.addEventListener("hellomoved", e => {
      var moved = e.originalEvent;
      var coords = [moved.clientX, moved.clientY].join();
      data.coords = coords;
      data.inputProps.value = coords;
      binding.update(data);
    });

    document.body.addEventListener("clickedonceonly", e => console.log(e.type));
  </script>
</body>
</html>